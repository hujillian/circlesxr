<html>
  <head>
    <meta charset="utf-8">

    <!-- Circles' head scripts [REQUIRED] -->
    <circles-start-scripts/>

    <!-- add your custom scripts here -->
    <!-- <script src="/worlds/hub/scripts/hub.js"></script> -->
    <script src="js/open-doors.js"></script>
    <script src="js/start-game.js"></script>
    <!-- <script src="js/switch-nav-mesh.js"></script> -->
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <!-- this is used to create our enter UI that creates a 2D overlay to capture a user gesture for sound/mic access etc. -->
    <circles-start-ui/>

    <!-- a-scene with 'circles-properties' component [REQUIRED] -->
    <a-scene circles_scene_properties start-game switch-nav-mesh audio-manager>
      <a-assets>
        <script>
          import { Audio } from 'circlesxr';
        </script>
        <!-- add your assets here. Note that you can use relative links or absolute paths to your world -->
        <!-- credit: HDRMaps @ https://hdrmaps.com/above-the-clouds/ -->
        <img id='skyMap' src='assets/textures/086_hdrmaps_com_free_above_clouds_lowres.jpg' crossorigin="anonymous">
        <!-- credit: Masakazu Matsumoto - https://www.flickr.com/photos/vitroids/3033329561/ -->
        <img id='earth_jpg' src='assets/textures/earth.jpg' crossorigin="anonymous">
        <img id='earthLowRes_jpg' src='assets/textures/earth_lowres.jpg' crossorigin="anonymous">

        <img id='outside_jpg' src='assets/textures/outside_screenshot.jpg' crossorigin="anonymous">

        <!-- credit: "Journey to Heaven on Earth Every Day with Nature" By TechMaestro - https://pixabay.com/de/users/awesomemeditations4u888-23921393/-->
        <audio id="backgroundMusic" src="assets/sounds/background_audio.mp3" preload="auto" crossorigin="anonymous"></audio>

        <!-- VoiceOvers -- All voiceovers are generated by AI -->
        <audio id="vcFiveDollar" src="assets/sounds/vcFiveDollar.mp3" preload="auto" crossorigin="anonymous"></audio>
        <audio id="vcHelmet" src="assets/sounds/vcHelmet.mp3" preload="auto" crossorigin="anonymous"></audio>
        <audio id="vcImaxCamera" src="assets/sounds/vcImaxCamera.mp3" preload="auto" crossorigin="anonymous"></audio>
        <audio id="vcSatellite" src="assets/sounds/vcSatellite.mp3" preload="auto" crossorigin="anonymous"></audio>
        <audio id="vcToolbox" src="assets/sounds/vcToolbox.mp3" preload="auto" crossorigin="anonymous"></audio>
        <audio id="vcJamesWebbTel" src="assets/sounds/vcJamesWebbTel.mp3" preload="auto" crossorigin="anonymous"></audio>

        <!-- Rooms-->
        <a-asset-item id="controlRoom_gltf" src="assets/models/spaceship/large_files/controlRoom.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="departureBay_gltf" src="assets/models/spaceship/large_files/departureBay.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="diningHall_gltf" src="assets/models/spaceship/large_files/diningHall.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="engine_gltf" src="assets/models/spaceship/engine.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="lobby_gltf" src="assets/models/spaceship/large_files/lobby.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="observatory_gltf" src="assets/models/spaceship/large_files/observatory.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="wingL_gltf" src="assets/models/spaceship/wingL.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="wingR_gltf" src="assets/models/spaceship/wingR.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="controlDesk_gltf" src="assets/models/spaceship/controldesk.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="floor_gltf" src="assets/models/spaceship/floor.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        
        <!-- Textures -->
        <!-- <img id="control_room_2_png" src="assets/models/spaceship/controlroom_UV_2.png">
        <img id="observatory_png" src="assets/models/spaceship/observatory_texture-01.png"> -->

      <!-- Doors -->
      <a-asset-item id="diningHall_back_gltf" src="assets/models/spaceship/doors/DiningDoor_Back.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="diningHall_front_gltf" src="assets/models/spaceship/doors/DiningDoor_Front.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="lobby_back_gltf" src="assets/models/spaceship/doors/LobbyDoor_Back.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="lobby_front_gltf" src="assets/models/spaceship/doors/LobbyDoor_Front.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
        
      <!-- James Webb telescope -->
      <a-asset-item id="jamesWebb_gltf" src="assets/models/jamesWebb.gltf" response-type="arraybuffer" crossorigin="anonymous" circles-sphere-env-map="src:#earthLowRes_jpg"></a-asset-item>
      
      <!-- Interior objects -->
      <a-asset-item id="fiveDollar_gltf" src="assets/models/interior_objects/fivedollarbill.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <img id="fiveDollar_jpg" src="assets/models/interior_objects/5_back.jpg">
      <a-asset-item id="helmet_gltf" src="assets/models/interior_objects/helmet.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="helmetStand_gltf" src="assets/models/interior_objects/helmetStand.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="imaxCamera_gltf" src="assets/models/interior_objects/imaxCamera.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="satellite_gltf" src="assets/models/interior_objects/satellite.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="toolbox_gltf" src="assets/models/interior_objects/toolbox.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
       
      <a-asset-item id="navmesh1_gltf" src="assets/models/spaceship/nav_meshes/lobbyfloor.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="navmesh2_gltf" src="assets/models/spaceship/nav_meshes/lobby_observatory_control_floor.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="navmesh3_gltf" src="assets/models/spaceship/nav_meshes/lobby_observatory_control_dining_floor.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <a-asset-item id="navmesh4_gltf" src="assets/models/spaceship/nav_meshes/lobby_observatory_control_dining_bay_floor.gltf" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      
        <!-- Circles' built-in assets [REQUIRED] -->
      <circles-assets/>
    </a-assets>

      <!-- Circles' built-in manager and avatar [REQUIRED] -->
      <circles-manager-avatar/>

      <!-- just creating an entity that connects many elements together -->
      <!-- <a-entity id="game_manager" lights-interactive></a-entity> -->

      <!-- Checkpoints -->
      <a-entity circles-checkpoint position="3.17 0.145 -0.13"></a-entity> <!-- lobby -->
      <a-entity circles-checkpoint position="0 0.145 -8"></a-entity> <!-- control room -->
      <a-entity circles-checkpoint position="3.17 0.145 -15"></a-entity> <!-- observatory -->
      <a-entity circles-checkpoint position="0 0.145 -19"></a-entity> <!-- observatory -->
      <a-entity circles-checkpoint position="-4 0.145 -10"></a-entity> <!-- control room -->
      <a-entity circles-checkpoint position="-3.17 0.145 -0.13"></a-entity> <!-- dining hall -->
      <a-entity circles-checkpoint position="0 0.145 8"></a-entity> <!-- departure bay -->

      <!-- We are no longer using Audio Manager, sticking with Circles-XR documentation -->
      <!----------------------- Audio Manager ------------------------------>
      <!-- <audio id="myAudio" src="public\assets\background_audio.mp3"></audio> -->
      <a-entity position="0 0 0" circles-sound="type:music; src:#backgroundMusic; autoplay:true; loop:true; volume:0.4; state:play;"></a-entity>

    <!-- Rooms -->
    <a-entity id="controlRoom" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#controlRoom_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="departureBay" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#departureBay_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="diningHall" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#diningHall_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="engine" position="0 0 1" rotation="0 0 0" scale="1 1 1" gltf-model="#engine_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="lobby" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#lobby_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="observatory" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#observatory_gltf" circles-sphere-env-map="src:#skyMap"></a-entity> <!-- circles-material-override="src:#observatory_png"-->
    <a-entity id="wingL" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#wingL_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="wingR" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#wingR_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="controlDesk" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#controlDesk_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="floor" position="0 0.1 0" rotation="0 0 0" scale="1 1 1" gltf-model="#floor_gltf"></a-entity>

    <!-- Doors -->
    <a-entity id="diningHall_front" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#diningHall_front_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="diningHall_back" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#diningHall_back_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="lobby_front" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#lobby_front_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    <a-entity id="lobby_back" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#lobby_back_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    
    <!-- Portal -->
    <a-entity id="portal-outside" 
              position="-5 2.5 9" 
              circles-portal="img_src:#outside_jpg; title_text:Go Outside; link_url:/w/Outside">
            </a-entity>
    
    <!-- Buttons to open doors -->
    <!-- Doors between lobby and control room -->

    <!-- the isOpen part isn't working properly right now -->
    <!-- open-doors="id__1:lobbydoor_L_front; id__2:lobbydoor_R_front; isOpen:isOpen_lobbyFront;" -->
    <a-entity   id="button_1"
                circles-button="button_color:rgb(153, 223, 255); button_color_hover:rgb(63, 134, 166); diameter:0.5; click_sound:#notew_f;"
                position="6.04 2.6 -3.38" rotation="0 -3.3 90" scale="0.8 0.8 0.8"
                circles-sphere-env-map="src:#skyMap">
    </a-entity>
    <a-entity   id="button_2"
                circles-button="button_color:rgb(153, 223, 255); button_color_hover:rgb(63, 134, 166); diameter:0.45;"
                position="6.04 2.43 -6.65" rotation="0 0 90" scale="0.8 0.8 0.8"
                circles-sphere-env-map="src:#skyMap">
    </a-entity>
    <!-- Doors between control room and dining hall -->
    <a-entity   id="button_3"
                circles-button="button_color:rgb(153, 223, 255); button_color_hover:rgb(63, 134, 166); diameter:0.45;" 
                position="-6.06 2.82 -6.39" rotation="0 180 90" scale="0.8 0.8 0.8"
                circles-sphere-env-map="src:#skyMap">
    </a-entity>
    <a-entity   id="button_4"
                circles-button="button_color:rgb(153, 223, 255); button_color_hover:rgb(63, 134, 166); diameter:0.45;" 
                position="-6.06 3.18 -4.03" rotation="0 180 90" scale="0.8 0.8 0.8"
                circles-sphere-env-map="src:#skyMap">
    </a-entity>
    <!-- Doors between dining hall and departure bay-->
    <a-entity   id="button_5"
                circles-button="button_color:rgb(153, 223, 255); button_color_hover:rgb(63, 134, 166); diameter:0.45;" 
                position="-6.06 3.13 3.97" rotation="0 180 90" scale="0.8 0.8 0.8"
                circles-sphere-env-map="src:#skyMap">
    </a-entity>
    <a-entity   id="button_6"
                circles-button="button_color:rgb(153, 223, 255); button_color_hover:rgb(63, 134, 166); diameter:0.45;" 
                position="-6.06 2.3 6.05" rotation="0 180 90" scale="0.8 0.8 0.8"
                circles-sphere-env-map="src:#skyMap">
    </a-entity>

    <!-- <a-entity id="universal_button">
      <a-entity open-doors class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255, 100, 100)"
                animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200"
                animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200"
                animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
      <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
    </a-entity> -->

    <!-- Interior objects -->
    <!-- Description credit: https://www.bankofcanada.ca/banknotes/bank-note-series/frontiers/5-polymer-note/ -->
    <a-entity id="fiveDollar" geometry="primitive: box; width:1.25;height:0.5;depth:0.01;" material="src: #fiveDollar_jpg" position="0 1.66 -10" rotation="288 0 0"
              circles-sphere-env-map="src:#skyMap"
              circles-artefact="inspectScale:1 1 1; textRotationY:90.0; inspectRotation:0.0 0.0 0;
              label_offset:0.0 0.3 0.0; arrow_position:down; descriptionLookAt:true;
              title:Canadian $5 Bill;
              description:The Canadian $5 bill features the Canadarm and an astronaut, who represents all Canadians who have contributed to the space program and the research conducted on the International Space Station.;
              label_text:$5;
              audio:#vcFiveDollar; 
              volume:0.6;">
    </a-entity>

    <a-entity id="helmet" position="0 2 11.4" rotation="0 0 0" scale="1 1 1" gltf-model="#helmet_gltf"
              circles-sphere-env-map="src:#skyMap"
              circles-artefact="inspectScale:1 1 1; textRotationY:0.0; inspectRotation:0.0 180.0 0;
              label_offset:0.0 1.0 0.0; arrow_position:down; descriptionLookAt:true;
              title:Helmet;
              description:The Canadarm supported astronauts during space walks. Spacewalks can last up to 5-7 hours!;
              label_text:Helmet;
              audio:#vcHelmet; 
              volume:0.6;">
    </a-entity>

    <a-entity id="helmetStand" position="0 0 0" rotation="0 0 0" scale="1 1 1" gltf-model="#helmetStand_gltf" circles-sphere-env-map="src:#skyMap"></a-entity>
    
    <a-entity id="imaxCamera" position="4.8 5.3 -12.1" rotation="15 -20 0" scale="1 1 1" gltf-model="#imaxCamera_gltf"
              circles-sphere-env-map="src:#skyMap"
              circles-artefact="inspectScale:1 1 1; textRotationY:0.0; inspectRotation:15 -20 0;
              label_offset:0.0 -0.7 0.0; label_arrow_position:up; descriptionLookAt:true;
              description_offset: 0.0 -0.7 0.0; desc_arrow_position: up;
              title:Camera;
              description:There are 2 IMAX cameras on the Canadarm that film and document the experience of astronauts in space.;
              label_text:Imax Camera;
              audio:#vcImaxCamera; 
              volume:0.6;">
    </a-entity>
    <a-entity id="satellite" position="-3 5 -10.4" rotation="110 50 0" scale="1 1 1" gltf-model="#satellite_gltf"
              circles-sphere-env-map="src:#skyMap"
              circles-artefact="inspectScale:0.7 0.7 0.7; textRotationY:0.0; inspectRotation:110 50 0;
              label_offset:0.0 -1.0 0.0; label_arrow_position:up; descriptionLookAt:true;
              description_offset: 0.0 -1.0 0.0; desc_arrow_position: up;
              title:Satellite;
              description:The Canadarm was used to send satellites into orbit.;
              label_text:Satellite;
              audio:#vcSatellite; 
              volume:0.6;">
    </a-entity>
    <a-entity id="toolbox" position="1 0.3 -11.6" rotation="0 180 0" scale="1 1 1" gltf-model="#toolbox_gltf"
              circles-sphere-env-map="src:#skyMap"
              circles-artefact="inspectScale:1 1 1; textRotationY:0.0; inspectRotation:0.0 180.0 0;
              label_offset:0.0 1.0 0.0; arrow_position:down; descriptionLookAt:true;
              title:Toolbox;
              description:The Canadarm helped perform repairs on satellites and the International Space Station. A notable use was repairing the Hubble Space Telescope.;
              label_text:Toolbox;
              audio:#vcToolbox; 
              volume:0.6;">
    </a-entity>

    <!-- James Webb telescope -->
    <a-entity id="jamesWebb" position="30 0 -47" rotation="0 -70 0" scale="1 1 1" gltf-model="#jamesWebb_gltf"
              circles-sphere-env-map="src:#skyMap"
              circles-artefact="inspectScale:1 1 1; textRotationY:0.0; inspectRotation:0.0 180.0 0;
              label_offset:0.0 1.0 0.0; arrow_position:down; descriptionLookAt:true;
              title:James Webb Space Telescope;
              description:The James Webb telescope is currently the most powerful space telescope. It is a collaboration between NASA, the European Space Agency, and the Canadian Space Agency.;
              label_text:James Webb Telescope;
              audio:#vcJamesWebbTel; 
              volume:0.6;">
            </a-entity>


      <!-- <a-entity id="nav-mesh" gltf-model="#navmesh1_gltf" visible='true' nav-mesh position="0 1 0"></a-entity> -->
      <a-entity id="nav-mesh" gltf-model="#navmesh4_gltf" visible='false' nav-mesh position="0 1 0"></a-entity>

      <!-- sky and lights -->
      <a-entity id="sunlight" position="0 20 0" rotation="40 0 0" 
                light="type:directional; intensity:4; color:#d5e4f5; castShadow:false;"></a-entity>
      <!-- <a-entity light="type:hemisphere; color:#FFFFFF; groundColor:#BCE2F4; intensity:3.0"></a-entity> -->

      <!-- Temporary lights: just so we can see better in the rooms -->
      <a-entity id="lobby_light" position="2.5 2.5 0" light="type:point; color:#FFFFFF; intensity:1.0"></a-entity> 
      <a-entity id="dininghall_light" position="-3.5 2.5 0" light="type:point; color:#FFFFFF; intensity:1.0"></a-entity> 
      <a-entity id="observatory_light" position="0 -0.5 0" light="type:point; color:#FFFFFF; intensity:1.0"></a-entity> 
      <!-- <a-entity id="jameswebb_light" position="16 13 -47" light="type:point; color:#FFFFFF; intensity:5; decay:0.5;"></a-entity>  -->

      <!-- <a-entity id='skyBox'
                rotation='0 200 0'
                geometry='primitive:sphere; radius:50; segments-height:24; segments-width:24;'
                material='shader:flat; src:#skyMap; side:back;'>
      </a-entity> -->

      <a-entity id='spaceBox'
                rotation='0 200 0'
                geometry='primitive:sphere; radius:100; segments-height:24; segments-width:24;'
                material='shader:flat; src:#earth_jpg; side:back;'>
      </a-entity>

      <!-- <a-entity environment="preset:starry;"></a-entity> -->
    </a-scene>
    <!-- Circles' end scripts [REQUIRED] -->
    <circles-end-scripts/>
    
  </body>
</html>
